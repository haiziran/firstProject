/**
 * Created by Administrator on 2017/4/27.
 */
//获取当前url地址
$.getUrlParam = function(name)
{
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r!=null) return unescape(r[2]); return null;
};
// alert(window.location.href);
// alert($.getUrlParam('eId'));
// alert($.getUrlParam('eIdToken'));
var eId=$.getUrlParam('eId');   //loginId
var eIdToken=$.getUrlParam('eIdToken'); //token
var pId=$.getUrlParam('pId');
//后台地址
var myUrl="http://192.168.3.31:8080/bim/";
var testUrl="http://192.168.3.70:8080/bim/";
//消息提示全局配置
toastr.options = {
       "closeButton": false,//是否配置关闭按钮
       "debug": false,//是否开启debug模式
       "newestOnTop": false,//新消息是否排在最上层
       "progressBar": false,//是否显示进度条
       "positionClass": "toast-center-center",//消息框的显示位置
       "preventDuplicates": false,//是否阻止弹出多个消息框
       "onclick": null,//点击回调函数
       "showDuration": "300",
       "hideDuration": "1000",
       "timeOut": "1500",//1.5s后关闭消息框
       "extendedTimeOut": "1000",
       "showEasing": "swing",
       "hideEasing": "linear",
       "showMethod": "fadeIn",
       "hideMethod": "fadeOut"
};
//enter.html
$().ready(function(){
    //登录界面
    $('.aOneSubmitMess').click(function(){
        if($('#username').val() =="" || $('#password').val() ==""){
            alert("用户名或密码不能为空")
        }else{
            $.ajax({
                type:"POST",
                url:myUrl+"account/base/login",
                cache:true,
                // data:"&loginName=" + escape($('#username').val()) +"&loginPwd=" + escape($('#password').val()),
                data:{loginName:$('#username').val(),loginPwd:$('#password').val()},
                success:function(enterSection){
                    // console.log(typeof enterSection.code);
                    if(enterSection.code == 0){
                        toastr.success("登录成功");
                        console.log(enterSection);
                        // console.log(enterSection.result.loginId);
                        // console.log(typeof enterSection.result.loginId);
                        window.location.href ="home.html?eId="+enterSection.result.loginId+'&'+"eIdToken="+enterSection.result.token;
                        // alert(window.location.href);
                    }else if(enterSection.code == 20002){
                        alert("登录失败")
                    } else if(enterSection.code == 20006){
                        alert("用户名不存在")
                    } else if(enterSection.code == 10002){
                        alert("没有请求权限")
                    }
                },
                error:function (str) {
                    // alert("检查后端数据类型");
                    // console.log(str.code);
                }
            })
        }
    });
});
$().ready(function(){
//home.html
    $(function () {
        $(document).on('click','.enterIndex',function(){
            var pId=$(this).parent('div').parent('div').attr('data-id'); //获取项目编号
            // alert(pId);
            $.getUrlParam = function(name)
            {
                var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r!=null) return unescape(r[2]); return null;
            };
            window.location.href="index.html?eId="+$.getUrlParam('eId')+'&'+"eIdToken="+$.getUrlParam('eIdToken')+'&'+'pId='+pId;
            //进入页面自动加载index.html左侧创建进度
            window.onload=(function () {
                $.ajax({
                    type: "POST",
                    url: myUrl + "pace/projectPacelist",
                    data: {loginId:eId,token:eIdToken, pId: pId},
                    success: function (data) {
                        if (data.code == 0) {
                            // alert("显示成功");
                            $('.bThreeOneContentList').css('display', 'none');
                            if (!$.isEmptyObject(data)) {
                                var jasonTree = data.result;
                                /*添加无级树*/
                                if ($('.bThreeOneContentMessTitle1 ul').length > 0) {
                                    $('.bThreeOneContentMessTitle1 ul:gt(0)').css('background', 'red');
                                    $('.bThreeOneContentMessTitle1 ul').remove();
                                }
                                strf = "";
                                $('.bThreeOneContentMessTitle1').append(forTree(jasonTree, true));
                            }
                            // console.log(str);
                        }
                        else {
                            // alert("请添加项目任务")
                        }
                    }
                })
            });
        })
    });
    $(function () {
        $('.bThreeOneBack').click(function () {
            $.getUrlParam = function(name)
            {
                var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r!=null) return unescape(r[2]); return null;
            };
            window.location.href='home.html?eId='+$.getUrlParam('eId')+'&'+"eIdToken="+$.getUrlParam('eIdToken');
        })
    });
    //进度显示-添加任务
    $(function () {
        //申明当前function变量函数
        var ulId;
        var nameId;
        var startTime;
        var endTime;
        //中间--添加任务
        $('.cSevenFiveSubmit').click(function(e){
            e.preventDefault();
            $.ajax({
                type:"POST",
                url:myUrl+"pace/projectPaceInsert",
                data:{loginId:eId,token:eIdToken,pId:pId,paceName:$("#paceName").val(),parentPaceId:0},
                success:function (cSevenFiveSubmitDate)
                {
                    console.log(cSevenFiveSubmitDate);
                    //父级添加获取数据
                    if(cSevenFiveSubmitDate.code==0){
                        $.ajax({
                            type:"POST",
                            url:myUrl+"pace/projectPacelist",
                            data:{loginId:eId,token:eIdToken,pId:pId},
                            success:function (cSevenFiveSubmitDateList) {
                                if(cSevenFiveSubmitDateList.code==0){
                                    // alert("添加父级成功");
                                    // console.log(data);
                                    $('.bThreeOneContentList').css('display','block');
                                    $(".cSevenFiveContent input").val("");
                                    $('.bThreeOneShow').trigger('click');
                                    if(!$.isEmptyObject(cSevenFiveSubmitDateList)){
                                        var jasonTree=data.result;
                                        /*添加无级树*/
                                        if($('.bThreeOneContentMessTitle1 ul').length >0){
                                            // $('.bThreeOneContentMessTitle ul:gt(0)').modelCSS('background','red');
                                            $('.bThreeOneContentMessTitle1 ul:gt(0)').remove();
                                        }
                                        strf="";
                                        $('.bThreeOneContentMessTitle1').append(forTree(jasonTree,true));

                                    }
                                    //添加任务--子级点击添加
                                    $('.bThreeOneContentMessTitle1 ul').on("click",".bThreeOneList6",function () {
                                        var ulId=$(this).parents("ul").attr("pid");
                                        //子级进度添加弹窗显示
                                        $('.cSevenFiveOne').css('display','block');
                                        $('#popLayer').css('display','block');
                                        //    点击X，弹窗消失
                                        $('.cSevenFiveBack').click(function(){
                                            $('.cSevenFiveOne').css('display','none');
                                            $('#popLayer').css('display','none')
                                        });
                                        //提交-效果隐藏
                                        $('.cSevenFiveSubmitOne').click(function () {
                                            $('.cSevenFiveOne').css('display','none');
                                            $('#popLayer').css('display','none');
                                            //数据请求接口
                                            $.ajax({
                                                type:"POST",
                                                url:myUrl+"pace/projectPaceInsert",
                                                data:{paceName:$("#paceNameOne").val(),parentPaceId :ulId,pId:pId,loginId:eId,token:eIdToken},
                                                success:function (data) {
                                                    $.ajax({
                                                        type:"POST",
                                                        url:myUrl+"pace/projectPacelist",
                                                        data:{loginId:eId,token:eIdToken,pId:pId},
                                                        success:function () {
                                                            if(data.code==0){
                                                                // alert('添加子级成功');
                                                                if(!$.isEmptyObject(data)){
                                                                    var jasonTree=data.result;
                                                                    /*添加无级树*/
                                                                    if($('.bThreeOneContentMessTitle ul').length >1){
                                                                        // $('.bThreeOneContentMessTitle ul:gt(0)').modelCSS('background','red');
                                                                        $('.bThreeOneContentMessTitle ul:gt(0)').remove();
                                                                    }
                                                                    $('.bThreeOneContentMessTitle1').append(forTree(jasonTree,true));
                                                                    $('.bThreeOneShow').trigger('click');
                                                                }
                                                            }
                                                        }
                                                    })
                                                },
                                                error:function () {
                                                }
                                            });
                                        })
                                    });
                                    //进度管理-子级+展开
                                    $('.bThreeOneContentMessTitle1 ul .bThreeOneList12').on("click",".bThreeOneImg",function (event) {
                                        var target =event.target;
                                        var parent=$(target).parents()[1];
                                        var next=$(parent).next();
                                        if($(next).css('display') =='none'){
                                            $(this).addClass('bThreeOneList111');
                                            $(next).css('display','block');
                                            $(this).removeClass('bThreeOneList11');
                                        }else{
                                            $(next).css('display','none');
                                            $(this).removeClass('bThreeOneList111');
                                            $(this).addClass('bThreeOneList11');
                                        }
                                        // var aa=$(this).parents("ul").attr(".bThreeOneFather");
                                        // var next=$(this).parents.().next("ul").attr('.bThreeOneChildren');
                                        // if($(next).modelCSS('display')=='none'){
                                        //     $(this).addClass('bThreeOneList111');
                                        //     $(next).modelCSS('display','block');
                                        //     $(this).removeClass('bThreeOneList11');
                                        // }else{
                                        //     $(next).modelCSS('display','none');
                                        //     $(this).removeClass('bThreeOneList111');
                                        //     $(this).addClass('bThreeOneList111');
                                        // }

                                    });
                                    //进度管理-上下移动图标--向上
                                    $('.bThreeOneContentMessTitle1 ul .bThreeOneList2').on("click",".upr",function () {
                                        var arr=$(this).parents("ul").attr("pid");
                                        var arrUp=$(this).parents().prev("ul").attr("pid");
                                        //参数请求
                                        $.ajax({
                                            type:"POST",
                                            url:myUrl+"/pace/projectPaceMove",
                                            data:{loginId:eId,token:eIdToken,pId:pId,upPace:arr,downPace:arrUp},
                                            success:function (str) {
                                                $('.bThreeOneShow').trigger('click');
                                            },
                                            error:function () {

                                            }
                                        });
                                    });
                                    //进度管理-上下移动图标--向下
                                    $('.bThreeOneContentMessTitle1 ul .bThreeOneList2').on("click",".downg",function () {
                                        var arr=$(this).parents("ul").attr("pid");
                                        var arrUp=$(this).parents().next("ul").attr("pid");
                                        //参数请求
                                        $.ajax({
                                            type:"POST",
                                            url:myUrl+"/pace/projectPaceMove",
                                            data:{loginId:eId,token:eIdToken,pId:pId,upPace:arr,downPace:arrUp},
                                            success:function (str) {
                                                $('.bThreeOneShow').trigger('click');
                                            },
                                            error:function () {
                                            }
                                        });
                                    });
                                    //添加任务--子级点击编辑
                                    $('.bThreeOneContentMessTitle1 ul').on("click",".bThreeOneList9",function(){
                                        // console.log($(this));
                                        // console.log($(this).parents("ul").attr("id"))
                                        ulId=$(this).parents("ul").attr("pid");      //取得所点击事件的父级ID
                                        nameId=$(this).parents("ul").children("li").children(".bThreeOneList11").html(); //取得所点击事件的任务名称
                                        startTime=$(this).parents("ul").children(".bThreeOneList4").html();
                                        endTime=$(this).parents("ul").children("li").children(".bThreeOneList13").html();
                                        $('.planStart').val(startTime);
                                        $('.planEnd').val(endTime);
                                        $('.cSevenFiveTwoTaskName').val(nameId);
                                        $('.cSevenFiveTwo').css('display','block');
                                        $('#popLayer').css('display','block');
                                        //    点击取消，弹窗消失
                                        $('.cSevenFiveTwoReset').click(function(){
                                            $('.cSevenFiveTwo').css('display','none');
                                            $('#popLayer').css('display','none')
                                        });
                                    });
                                    //添加任务--子级点击删除
                                    $('.bThreeOneContentMessTitle1 ul').on("click",".bThreeOneList10",function () {
                                        // var ulId=$(this).parents("ul").attr("id");      //取得所点击事件的父级ID
                                        var arr=new Array($(this).parents("ul").attr("pid"));
                                        var abb=JSON.stringify(arr);         //数组转为json数组
                                        // console.log(abb);
                                        // console.log(typeof abb);
                                        //参数请求
                                        $.ajax({
                                            type:"POST",
                                            url:myUrl+"pace/projectPaceDelete",
                                            data:{delPace:abb,loginId:eId,token:eIdToken,pId:pId},
                                            success:function (Md) {
                                                console.log(Md);
                                                // alert("删除成功");
                                                $('.bThreeOneShow').trigger('click');
                                            }
                                        })
                                    });
                                    //添加任务--子级构建
                                    $('.bThreeOneContentMessTitle1 ul').on("click",".bThreeOneList7",function () {
                                        //弹窗显示
                                        $('.bThreeThree').css('display','block');
                                        $('#popLayer').css('display','block');
                                        //弹窗关闭
                                        $('.bThreeThreeBack').click(function(){
                                            $('.bThreeThree').css('display','none');
                                            $('#popLayer').css('display','none')
                                        });

                                    })
                                }
                                else{
                                    // alert("请添加项目任务")
                                }
                            }
                        });

                    }else if(data.code=="20003"){
                        console.log("failed")
                    }
                    //子级点击添加
                },
                error:function () {
                }
            })
        });
        //左侧--创建进度
        $('.bThreeOneShow').click(function () {
            $('.bThreeOneContentMessTitle1 ul').unbind("click");
            $('.bThreeOneContent').css('display','block');
            $('.bThreeOneRight').css('display','block');
            $('.cSixOne').css('display','none');
            $('.cSixTwoOne').css('position','absolute').css('top','-9999px').css('left','-9999px');
            $('.cSixThree').css('display','none');
            $('.cThree').css('display','none');
            $('.cOne').css('display','none');
            $('.cFive').css('display','none');
            $('.cFour').css('display','none');
            if($('.bThreeOneContentList').css('display')=='none'){
                $('.bThreeOneContentList').css('display','block');
                $('.bThreeOneContentPicture').css({'height':$('.bThreeOneContentPicture').height() - $('.bThreeOneContentList').height()});
                $('.bThreeOneContentPicture canvas').css({'height': $('canvas').height()-$('.bThreeOneContentList').height()});
                // alert($('canvas').height());
                // parent.location.reload()
                // $('.bThreeOneContent').modelCSS({'height':$('.bThreeOneContent').height()- $('.bThreeOneContentList').height()});
                $('.shrinkDown').addClass('shrinkDowns');
            }else{
                $('.shrinkDown').removeClass('shrinkDowns');
            }
            $.ajax({
                type:"POST",
                url:myUrl+"pace/projectPacelist",
                data:{loginId:eId,token:eIdToken,pId:0},
                success:function (data) {
                    if(data.code==0){
                        // alert("显示成功");
                        $('.bThreeOneContentList').css('display','block');
                        if(!$.isEmptyObject(data)){
                            var jasonTree=data.result;
                            /*添加无级树*/
                            if($('.bThreeOneContentMessTitle1 ul').length >0){
                                $('.bThreeOneContentMessTitle1 ul:gt(0)').css('background','red');
                                $('.bThreeOneContentMessTitle1 ul').remove();
                            }
                            strf="";
                            $('.bThreeOneContentMessTitle1').append(forTree(jasonTree,true));
                            $(".bThreeOneContentMessTitle1 ul").find('.bThreeOneList12 .bThreeOneImg').click(function () {
                                // var ul =$(this).parent().siblings("ul");
                                // if (ul.find(".bThreeOneList12").html() != null) {
                                //     if (ul.modelCSS("display") == "none") {
                                //         $(this).addClass('bThreeOneList111');
                                //         $(this).parent().modelCSS('display','block');
                                //         $(this).removeClass('bThreeOneList11');
                                //     } else {
                                //         $(this).parent().addClass('bThreeOneList111');
                                //         $(this).parent().modelCSS('display','none');
                                //         $(this).parent().removeClass('bThreeOneList11');
                                //     }
                                // }
                            })
                        }
                        // console.log(str);
                    }
                    else{
                        // alert("请添加项目任务")
                    }
                    //进度管理-上下移动图标--向上
                    $('.bThreeOneContentMessTitle1 ul .bThreeOneList2').on("click",".upr",function () {
                        var arr=$(this).parents("ul").attr("pid");
                        var arrUp=$(this).parents().prev("ul").attr("pid");
                        $('.bThreeOneContentList').css('display','block');
                        //参数请求
                        $.ajax({
                            type:"POST",
                            url:myUrl+"/pace/projectPaceMove",
                            data:{loginId:eId,token:eIdToken,pId:pId,upPace:arr,downPace:arrUp},
                            success:function (data) {
                                $('.bThreeOneShow').trigger('click');
                            },
                            error:function () {

                            }
                        });
                    });
                    //进度管理-上下移动图标--向下
                    $('.bThreeOneContentMessTitle1 ul .bThreeOneList2').on("click",".downg",function () {
                        var arr=$(this).parents("ul").attr("pid");
                        var arrUp=$(this).parents().next("ul").attr("pid");
                        $('.bThreeOneContentList').css('display','block');
                        //参数请求
                        $.ajax({
                            type:"POST",
                            url:myUrl+"/pace/projectPaceMove",
                            data:{loginId:eId,token:eIdToken,pId:pId,upPace:arr,downPace:arrUp},
                            success:function (data) {
                                $('.bThreeOneShow').trigger('click');
                            },
                            error:function () {
                            }
                        });
                    });
                    //进度管理-子级+展开
                    $('.bThreeOneContentMessTitle1 ul .bThreeOneList12').on("click",".bThreeOneImg",function (event) {
                        // var target =event.target;
                        // var parent=$(target).parents()[1];
                        // var next=$(parent).next();
                        // if($(next).modelCSS('display') =='none'){
                        //     $(this).addClass('bThreeOneList111');
                        //     $(next).modelCSS('display','block');
                        //     $(this).removeClass('bThreeOneList11');
                        // }else {
                        //     $(next).modelCSS('display', 'none');
                        //     $(this).removeClass('bThreeOneList111');
                        //     $(this).addClass('bThreeOneList11');
                        // }
                        var target =event.target;
                        var parent=$(target).parents()[1];
                        var next=$(parent).next();     //兄弟级的下一级ul
                        var aa=$(this).parents("ul").attr('class');  //当前所点击的class
                        var bb=next.attr('class');                      //当前所点击的兄弟级下一级class
                        var cc="bThreeOneChildren";
                        if($(next).css('display') =='none'){          //有子级是隐藏状态
                            $(this).addClass('bThreeOneList111');
                            $(this).removeClass('bThreeOneList11');
                            // $(next).modelCSS('display','block');
                            if($(next).attr('class') == 'bThreeOneChildren'){
                                $(next).css('display','block');
                                // alert(11)
                            }
                        }else {                                         //有子级是展开状态
                            $(next).css('display','none');
                            $(this).removeClass('bThreeOneList111');
                            $(this).addClass('bThreeOneList11');
                            if($(next).attr('class') =='bThreeOneFather'){
                                // alert(22);
                                $(next).css('display', 'block');
                            }
                        }
                    });
                    //进度管理-子级进度添加
                    $('.bThreeOneContentMessTitle1 ul').on("click",".bThreeOneList6",function () {
                        var ulId=$(this).parents("ul").attr("pid");
                        //子级进度添加弹窗显示
                        $('.cSevenFiveOne').css('display','block');
                        $('#popLayer').css('display','block');
                        $('.bThreeOneContentList').css('display','block');
                        //    点击X，弹窗消失
                        $('.cSevenFiveBack').click(function(){
                            $('.cSevenFiveOne').css('display','none');
                            $('#popLayer').css('display','none')
                        });
                        //提交-效果隐藏
                        $('.cSevenFiveSubmitOne').click(function () {
                            $('.cSevenFiveOne').css('display','none');
                            $('#popLayer').css('display','none');
                            //数据请求接口
                            $.ajax({
                                type:"POST",
                                url:myUrl+"pace/projectPaceInsert",
                                data:{paceName:$("#paceNameOne").val(),parentPaceId :ulId,pId:pId,loginId:eId,token:eIdToken},
                                success:function (data) {
                                    $.ajax({
                                        type:"POST",
                                        url:myUrl+"pace/projectPacelist",
                                        data:{loginId:eId,token:eIdToken,pId:pId},
                                        success:function () {
                                            if(data.code==0){
                                                alert('添加子级项目成功');
                                                // console.log(data)
                                                if(!$.isEmptyObject(data)){
                                                    var jasonTree=data.result;
                                                    /*添加无级树*/
                                                    if($('.bThreeOneContentMessTitle1 ul').length >0){
                                                        // $('.bThreeOneContentMessTitle ul:gt(0)').modelCSS('background','red');
                                                        $('.bThreeOneContentMessTitle1 ul').remove();
                                                    }
                                                    $('.bThreeOneContentMessTitle1').append(forTree(jasonTree,true));
                                                }
                                                //模拟点击加载
                                                $('.bThreeOneShow').trigger('click');
                                            }
                                        }
                                    })
                                },
                                error:function () {
                                }
                            });
                        })
                    });
                    //进度管理-进度编辑弹窗
                    $('.bThreeOneContentMessTitle1 ul').on("click",".bThreeOneList9",function(e){
                        ulId=$(this).parents("ul").attr("pid");      //取得所点击事件的父级ID
                        nameId=$(this).parents("ul").children("li").children(".bThreeOneList11").html(); //取得所点击事件的任务名称
                        startTime=$(this).parents("ul").children(".bThreeOneList4").html();         //开始时间
                        endTime=$(this).parents("ul").children(".bThreeOneList13").html();          //结束时间
                        $('.planStart').val(startTime);
                        $('.planEnd').val(endTime);
                        $('.cSevenFiveTwoTaskName').val(nameId);
                        $('.bThreeOneContentList').css('display','block');
                        $('.cSevenFiveTwo').css('display','block');
                        $('#popLayer').css('display','block');
                        //    点击取消，弹窗消失
                        $('.cSevenFiveTwoReset').click(function(){
                            $('.cSevenFiveTwo').css('display','none');
                            $('#popLayer').css('display','none')
                        });
                    });
                    //进度管理-进度删除
                    $('.bThreeOneContentMessTitle1 ul').on("click",".bThreeOneList10",function (e) {
                        e.preventDefault();
                        // var ulId=$(this).parents("ul").attr("pid");      //取得所点击事件的父级ID
                        var arr=new Array($(this).parents("ul").attr("pid"));
                        var abb=JSON.stringify(arr);         //数组转为json数组
                        // console.log(abb);
                        // console.log(typeof abb);
                        //参数请求
                        $.ajax({
                            type:"POST",
                            url:myUrl+"pace/projectPaceDelete",
                            data:{delPace:abb,loginId:eId,token:eIdToken,pId:pId},
                            success:function (Md) {
                                console.log(Md);
                                // alert("删除成功");
                                //模拟点击加载
                                $('.bThreeOneShow').trigger('click');
                            }
                        })
                    });
                    //进度管理--构建
                    $('.bThreeOneContentMessTitle1 ul').on("click",".bThreeOneList7",function () {
                        //构建页数
                        // $.ajax({
                        //     type:"POST",
                        //     url:myUrl+"/pace/modelPacelistCount",
                        //     data:{parentId:ulId,pId:0},
                        //     success:function (gg) {
                        //         console.log(gg)
                        //     },
                        //     error:function () {
                        //
                        //     }
                        // })
                        //进度管理-构建--添加构建
                        //弹窗显示
                        $('.bThreeThree').css('display','block');
                        $('#popLayer').css('display','block');
                        //弹窗关闭
                        $('.bThreeThreeBack').click(function(){
                            $('.bThreeThree').css('display','none');
                            $('#popLayer').css('display','none')
                        });
                        ulId=$(this).parents("ul").attr("pid");      //取得所点击事件的父级ID
                        $.ajax({
                            type:"POST",
                            url:myUrl+"/pace/modelPacelist",
                            data:{pId:pId,parentId:ulId,pageNum:1,loginId:eId,token:eIdToken},
                            success:function(Gj){
                                console.log(Gj);
                            },
                            error:function () {

                            }
                        })
                    })
                }
            })
        });
            // 进度管理-进度编辑弹窗-点击保存，弹窗消失
            $('.cSevenFiveTwoKeep').click(function (e) {
                e.preventDefault();
                $('.cSevenFiveTwo').css('display','none');
                $('#popLayer').css('display','none');
                var str={"id":ulId,"name":$('.cSevenFiveTwoTaskName').val(),"planStart":$('.planStart').val(),"planEnd":$('.planEnd').val()};
                var ob=JSON.stringify(str);
                //数据请求接口
                $.ajax({
                    type:"POST",
                    url:myUrl+"pace//projectPaceModify",
                    data:{proPaceJson:ob, pId:pId, loginId:eId,token:eIdToken},
                    success:function (FF) {
                        console.log(FF);
                        alert("保存成功");
                        //模拟点击加载
                        $('.bThreeOneShow').trigger('click');
                    },
                    error:function () {
                        return false;
                    }
                });
            });

    });
//    模型数据获取
    $('#b_title').click(function(){
        $.ajax({
            type:'POST',
            url:myUrl+'/model/queryModelInfo',
            data:{loginId:eId,token:eIdToken,pId:pId,modelId:1},
            success:function(uE4m){
                if($('.cSixTwoOneTaskSecond1 div').length>0){
                    $('.cSixTwoOneTaskSecond1 div').remove()
                };
                if($('.cSixTwoOneTaskOne1 div').length>0){
                    $('.cSixTwoOneTaskOne1 div').remove()
                }
                console.log(uE4m);
                var tableUe4mm="";
                var tableUe4mms="";
                uE4m.result.commoninfo.forEach(function(item,index) {
                    console.log(item);
                    console.log(item.mCode);
                    tableUe4mm=
                        '<div class="taskNameDeta">几何属性</div>'+
                        '<div class="cSixTwoOneTaskLeft1" style="clear: both;">'+item.modelPropertyName+'</div>' +
                        '<div class="cSixTwoOneTaskRight1">'+item.modelPropertyValue+'</div>'+
                        '<div style="clear: both"></div>';
                    $('.cSixTwoOneTaskSecond1').append(tableUe4mm);
                });
            }
        })
    });
});
//单位管理
$().ready(function(){
    //创建单位
    $('.b7-btn').click(function(){
        $('.b8').css('display','block');
        $('#popLayer').css('display','block');
        //关闭弹窗
        $('.del').click(function(){
            $('.b8').css('display','none');
            $('#popLayer').css('display','none');
        });
        //添加创建单位的类型
        var unitItem=[{'id':'1','name':'业主单位'},
            {'id':'2','name':'勘察单位'},
            {'id':'3','name':'设计单位'},
            {'id':'4','name':'施工单位'},
            {'id':'5','name':'监理单位'}
        ];
        var unitType="";
        unitItem.forEach(function (item,index){
            unitType='<option uitId='+item.id+'>'+item.name+'</option>';
            $('.b8-select').append(unitType);
        });
        //移除重复
        var unitList=$('.b8-select option');
        unitList.each(function(index,item){
            if(index>unitItem.length -1){
                // alert(11)
                unitList[index].remove();
            }else{
                // alert(22);
                // unitList[index].remove();
            }
        })
    });
    $('#bEightSubmit').click(function(){
        $('.b8').css('display','none');
        $('#popLayer').css('display','none');
        var unitTypeId=$('.b8-select').children("option:selected").attr('uitId');
        // alert(unitTypeId);
        var aa={
            'name':$('#unitName').val(),
            'address':$('#unitAddress').val(),
            'phone':$('#unitPhone').val(),
            'type':unitTypeId
        };
        var bb=JSON.stringify(aa);
        // var formData = new FormData();
        // formData.append('loginId',eId)
        // formData.append('token',eIdToken)
        // formData.append('name',JSON.stringify($('#unitName').val()));
        // formData.append('address',JSON.stringify($('#unitAddress').val()));
        // formData.append('phone',JSON.stringify($('#unitName').val()));
        // formData.append('type',JSON.stringify($('#unitName').val()));
        // formData.append('type',JSON.stringify(unitTypeId));
        // console.log(formData)
        $.ajax({
            type:"POST",
            url:myUrl+'company/createCompanyInfo',
            // data:{loginId:eId,token:eIdToken,name:JSON.stringify($('#unitName').val()),address:JSON.stringify($('#unitAddress').val()),phone:JSON.stringify($('#unitPhone').val()),type:JSON.stringify(unitTypeId)},
            data:{loginId:eId,token:eIdToken,companyJson:bb},
            success:function(unit){
                if(unit.code == 0){
                    console.log(unit);
                    //模拟点击
                    $('.Unit').trigger('click');
                }
            }
        })
    });
    //全选删除
    $('#allSelectDelete').change(function(){
        if($(this).prop("checked")){
            $('.b7TbodyInput input').prop('checked','checked')
        }else{
            $('.b7TbodyInput input').removeAttr('checked')
        }
    });
    //选中删除
    $('.b7-left').click(function(){
        // alert(11)
        var userArr=[];
        $('.b7TbodyInput input').each(function(index,item){
            if($(this).get(0).checked){
                userArr.push($(this).parents("li").attr("id"));
                $(this).parents('li').remove();
            }
        });
        var dd=JSON.stringify(userArr);
        $.ajax({
            type:'POST',
            url:myUrl+'company/updateIsDelete',
            data:{companyIdjson:dd,loginId:eId,token:eIdToken},
            success:function(b7leftDelete){
                console.log(b7leftDelete);
                if(b7leftDelete.code == 0){
                    alert("删除成功")
                }
                //模拟点击
                $('.Manger').trigger('click');
            },
            error:function () {

            }
        })
    });
    //获取总条数-分页
    $('.Unit').click(function(){
        $.ajax({
            type:'POST',
            url:myUrl+'company/selectCount',
            data:{loginId:eId,token:eIdToken},
            success:function(selectCount){
                console.log(selectCount);
                var pagecoung =Math.ceil(selectCount.result/15);
                $('.b7-tbody').attr('selectId',pagecoung);
                $(".zxf_pagediv").createPage({
                    pageNum: pagecoung,
                    current: 1,
                    backfun: function(e) {
                        //console.log(e);//回调
                    }
                });
            }
        })
    });
    // 分页展示
    $('.zxf_pagediv').on('click','a',function(){
        var pageNumber= $(this).html();
        $.ajax({
            type:"POST",
            url:myUrl+"company/select",
            data:{pageNum:pageNumber,loginId:eId,token:eIdToken},
            success:function (pageNumList) {
                console.log(pageNumList);
                var pageNumberList="";
                if($('.b7-tbody').has('li').length>0){
                    $('ul.b7-tbody li').remove();
                    pageNumList.result.forEach(function (item,index) {
                        pageNumberList=
                            '<li id='+item.id+'>' +
                            '<span class="b7TbodyInput"><input type="checkbox" name="userName"></span>'+
                            '<span>'+item.name+'</span>'+
                            '<span>'+item.companyPhone+'</span>'+
                            '<span>'+item.companyAddress+'</span>'+
                            '<span>'+item.createTime+'</span>'+
                            '<span class="b7-tbodyEidit"><span class="exitb7">编辑</span><span class="deleteb7">删除</span></span>'+
                            '</li>';
                        $('ul.b7-tbody').append(pageNumberList);
                    });
                }else{
                    pageNumList.result.forEach(function (item,index) {
                        pageNumberList=
                            '<li>' +
                            '<span class="b7TbodyInput"><input type="checkbox" name="userName"></span>'+
                            '<span>'+item.name+'</span>'+
                            '<span>'+item.companyPhone+'</span>'+
                            '<span>'+item.companyAddress+'</span>'+
                            '<span>'+item.createTime+'</span>'+
                            '<span class="b7-tbodyEidit"><span class="exitb7">编辑</span><span class="deleteb7">删除</span></span>'+
                            '</li>';
                        $('ul.b7-tbody').append(pageNumberList);
                    });
                }
            },
            error:function () {
            }
        })
    });
    //分页确定按钮
    $('.zxf_pagediv').on('click','.zxfokbtn',function(){
        // alert(11)
        // $('.zxfokbtn').attr('id','UnitLoad')
        var pageNum= $('.zxfinput').val();
        $.ajax({
            type:"POST",
            url:myUrl+"company/select",
            data:{pageNum:pageNum,loginId:eId,token:eIdToken},
            success:function (pageNumList) {
                // console.log(pageNumList);
                var pageNumberList="";
                if($('.b7-tbody').has('li').length>0){
                    $('ul.b7-tbody li').remove();
                    pageNumList.result.forEach(function (item,index) {
                        pageNumberList=
                            '<li id='+item.id+'>' +
                            '<span class="b7TbodyInput"><input type="checkbox" name="userName"></span>'+
                            '<span>'+item.name+'</span>'+
                            '<span>'+item.companyPhone+'</span>'+
                            '<span>'+item.companyAddress+'</span>'+
                            '<span>'+item.createTime+'</span>'+
                            '<span class="b7-tbodyEidit"><span class="exitb7">编辑</span><span class="deleteb7">删除</span></span>'+
                            '</li>';
                        $('ul.b7-tbody').append(pageNumberList);
                    });
                }else{
                    pageNumList.result.forEach(function (item,index) {
                        pageNumberList=
                            '<li>' +
                            '<span class="b7TbodyInput"><input type="checkbox" name="userName"></span>'+
                            '<span>'+item.name+'</span>'+
                            '<span>'+item.companyPhone+'</span>'+
                            '<span>'+item.companyAddress+'</span>'+
                            '<span>'+item.createTime+'</span>'+
                            '<span class="b7-tbodyEidit"><span class="exitb7">编辑</span><span class="deleteb7">删除</span></span>'+
                            '</li>';
                        $('ul.b7-tbody').append(pageNumberList);
                    });
                }
            },
            error:function () {
            }
        })
    });
    //搜索单位
    $('.b7-right').on('click','span',function(){
        var pageSearch=$('.zxf_pagediv').children('.current').html();
        if($('.unitInputSearch').val() !== ''){
            if($(this).hasClass('unitSearch')){
                $(this).removeClass('unitSearch');
                $(this).addClass('unitBack');
                $.ajax({
                    type:'POST',
                    url:myUrl+'company/likeSelectCompany',
                    data:{loginId:eId,token:eIdToken,pageNum:pageSearch,condition:$('.unitInputSearch').val()},
                    success:function(unitSearch){
                        console.log(unitSearch);
                        if(unitSearch.code == 0){
                            var pageNumberList="";
                            $('.b7-tbody li').remove();
                            unitSearch.result.forEach(function(item,index){
                                console.log(item);
                                pageNumberList=
                                    '<li>' +
                                    '<span class="b7TbodyInput"><input type="checkbox" name="userName"></span>'+
                                    '<span>'+item.name+'</span>'+
                                    '<span>'+item.companyPhone+'</span>'+
                                    '<span>'+item.companyAddress+'</span>'+
                                    '<span>'+item.createTime+'</span>'+
                                    '<span class="b7-tbodyEidit"><span class="exitb7">编辑</span><span class="deleteb7">删除</span></span>'+
                                    '</li>';
                                $('ul.b7-tbody').append(pageNumberList);
                            })
                        }
                    }
                });
                // alert(11)
            }else{
                $(this).addClass('unitSearch');
                $(this).removeClass('unitBack');
                $('.unitInputSearch').val('');
                // alert(22)
                $('.b7-tbody li').remove();
                $('.Unit').trigger('click');
            }
        }else{
            toastr.error('请输入搜索内容！')
        }

    });

    // function showData(bathData){
    // 	if(bathData.count && batchData.batchList){
    // 		var pageCount =Math.ceil(bathData.count/15);
    // 		$('.b7-tbody').attr('selectCount',pageCount);
    // 		//调用分页
    // 		laypage({
    // 			cont: 'pagination',
    // 			// pages: pageCount,
    // 			// curr: location.hash.replace('#!fenye=', ''), //获取hash值为fenye的当前页
    // 			// hash: 'fenye', //自定义hash值
    // 			jump:function(obj){
    // 				var pageNumber =obj.cuur;
    // 				if(pageNumber>1){
    // 					//网络请求
    // 					console.log("分页请求");
    // 					var url =myUrl+'company/selectCount' + pageNumber;  //""里面的内容是你调用后台接口分页的的路径
    // 					getData(url,"post",{loginId:eId,token:eIdToken},function(data){
    // 						console.log("data",data);
    // 						//数据返回成功后的操作
    // 					})  //{}里面是你请求ajax后台数据所带的参数
    // 				}
    // 			}
    // 		})
    // 	}
    // }
    // //处理ajax
    // function getData(url, method,parm,callback){
    // 	$.ajax({
    // 		url:url,
    // 		type:method,
    // 		dataType:'json',
    // 		data:parm,
    // 		success:function(data){
    // 			callback(data);
    // 		},
    // 		error:function(err){
    // 			alert(err);
    // 		}
    // 	})
    // }
//index.html
    //页面返回'
});
//系统管理
$().ready(function(){
    $('.System').click(function () {
        $.ajax({
            type:'POST',
            url:myUrl+'systemConfig/selectSysConfigByPage',
            data:{loginId:eId,token:eIdToken,pageNum:1},
            cache:false,
            success:function(system){
                // console.log(system);
                if(system.code == 0){
                    var list="";
                    system.result.forEach(function(item,index){
                        // console.log(item);
                        list=
                            '<div class="bNineListColor">'+
                            '<ul sysId='+item.sysId+'>' +
                            '<li class="bNineListOne">'+item.sysName+'</li>'+
                            '<li class="bNineListTwo">'+item.sysCode+'</li>'+
                            '<li class="bNineListThree">'+item.sysValue+'</li>'+
                            '<li class="bNineListFour">'+item.sysRemake+'</li>'+
                            '<li class="bNineListEdit">修改</li>'+
                            '<li class="bNineListDel">删除</li>'+
                            '<div style="clear: both"></div>'+
                            '</ul>'+
                            '</div>';
                        $('.bNineContentMain').append(list);
                    });
                    var lists=$('.bNineContentMain .bNineListColor');
                    //移除重复
                    lists.each(function(index,item){
                        if(index>system.result.length-1){
                            lists[index].remove();
                        }
                    });
                }else{

                }
            },
            error:function () {
            }
        });
        //获取总条数
        $.ajax({
            type:'POST',
            url:myUrl+'systemConfig/selectCount',
            data:{loginId:eId,token:eIdToken},
            success:function(count){
                console.log(count);
                var pageNum=Math.ceil(count.result/15)
                $(".systemPage").createPage({
                    pageNum: pageNum,
                    current: 1,
                    backfun: function(e) {
                        //console.log(e);//回调
                    }
                });
            }
        })
    });
    //分页展示
    $('.systemPage').on('click','a',function(){
        var pageNu=$(this).html();
        $.ajax({
            type:'POST',
            url:myUrl+'systemConfig/selectSysConfigByPage',
            data:{loginId:eId,token:eIdToken,pageNum:pageNu},
            success:function(system){
                // console.log(system);
                if($('.bNineContentMain').has('.bNineListColor').length >0){
                    $('.bNineContentMain .bNineListColor').remove();
                    var list="";
                    system.result.forEach(function(item,index){
                        // console.log(item);
                        list=
                            '<div class="bNineListColor">'+
                            '<ul sysId='+item.sysId+'>' +
                            '<li class="bNineListOne">'+item.sysName+'</li>'+
                            '<li class="bNineListTwo">'+item.sysCode+'</li>'+
                            '<li class="bNineListThree">'+item.sysValue+'</li>'+
                            '<li class="bNineListFour">'+item.sysRemake+'</li>'+
                            '<li class="bNineListEdit">修改</li>'+
                            '<li class="bNineListDel">删除</li>'+
                            '<div style="clear: both"></div>'+
                            '</ul>'+
                            '</div>';
                        $('.bNineContentMain').append(list);
                    });
                }else{
                    var list="";
                    system.result.forEach(function(item,index){
                        console.log(item);
                        list=
                            '<div class="bNineListColor">'+
                            '<ul sysId='+item.sysId+'>' +
                            '<li class="bNineListOne">'+item.sysName+'</li>'+
                            '<li class="bNineListTwo">'+item.sysCode+'</li>'+
                            '<li class="bNineListThree">'+item.sysValue+'</li>'+
                            '<li class="bNineListFour">'+item.sysRemake+'</li>'+
                            '<li class="bNineListEdit">修改</li>'+
                            '<li class="bNineListDel">删除</li>'+
                            '<div style="clear: both"></div>'+
                            '</ul>'+
                            '</div>';
                        $('.bNineContentMain').append(list);
                    });
                }
            },
            error:function () {
            }
        });
    });
    //分页确定按钮
    $('.systemPage').on('click','zxfokbtn',function(){
        var pageNu=$('.zxfinput').val();
        $.ajax({
            type:'POST',
            url:myUrl+'systemConfig/selectSysConfigByPage',
            data:{loginId:eId,token:eIdToken,pageNum:pageNu},
            success:function(system){
                // console.log(system);
                if($('.bNineContentMain').has('.bNineListColor').length >0){
                    $('.bNineContentMain .bNineListColor').remove();
                    var list="";
                    system.result.forEach(function(item,index){
                        // console.log(item);
                        list=
                            '<div class="bNineListColor">'+
                            '<ul sysId='+item.sysId+'>' +
                            '<li class="bNineListOne">'+item.sysName+'</li>'+
                            '<li class="bNineListTwo">'+item.sysCode+'</li>'+
                            '<li class="bNineListThree">'+item.sysValue+'</li>'+
                            '<li class="bNineListFour">'+item.sysRemake+'</li>'+
                            '<li class="bNineListEdit">修改</li>'+
                            '<li class="bNineListDel">删除</li>'+
                            '<div style="clear: both"></div>'+
                            '</ul>'+
                            '</div>';
                        $('.bNineContentMain').append(list);
                    });
                }else{
                    var list="";
                    system.result.forEach(function(item,index){
                        console.log(item);
                        list=
                            '<div class="bNineListColor">'+
                            '<ul sysId='+item.sysId+'>' +
                            '<li class="bNineListOne">'+item.sysName+'</li>'+
                            '<li class="bNineListTwo">'+item.sysCode+'</li>'+
                            '<li class="bNineListThree">'+item.sysValue+'</li>'+
                            '<li class="bNineListFour">'+item.sysRemake+'</li>'+
                            '<li class="bNineListEdit">修改</li>'+
                            '<li class="bNineListDel">删除</li>'+
                            '<div style="clear: both"></div>'+
                            '</ul>'+
                            '</div>';
                        $('.bNineContentMain').append(list);
                    });
                }
            },
            error:function () {
            }
        });
    });
    //搜索
    $('.bNineContentHeader').on('click','span',function(){
        var pageSearch=$('.systemPage').children('.current').html();
        if($('.systemInput').val() !== ''){
            if($(this).hasClass('systemSearch')){
                $(this).removeClass('systemSearch');
                $(this).addClass('systemBack');
                $.ajax({
                    type:'POST',
                    url:myUrl+'systemConfig/likeSelectSysConfig',
                    data:{loginId:eId,token:eIdToken,pageNum:pageSearch,condition:$('.systemInput').val()},
                    success:function(system){
                        // console.log(system);
                        if(system.code == 0){
                            $('.bNineContentMain .bNineListColor').remove();
                            var list="";
                            system.result.forEach(function(item,index){
                                // console.log(item);
                                list=
                                    '<div class="bNineListColor">'+
                                    '<ul sysId='+item.sysId+'>' +
                                    '<li class="bNineListOne">'+item.sysName+'</li>'+
                                    '<li class="bNineListTwo">'+item.sysCode+'</li>'+
                                    '<li class="bNineListThree">'+item.sysValue+'</li>'+
                                    '<li class="bNineListFour">'+item.sysRemake+'</li>'+
                                    '<li class="bNineListEdit">修改</li>'+
                                    '<li class="bNineListDel">删除</li>'+
                                    '<div style="clear: both"></div>'+
                                    '</ul>'+
                                    '</div>';
                                $('.bNineContentMain').append(list);
                            });
                        }
                    }
                });
                // alert(11)
            }else{
                $(this).addClass('systemSearch');
                $(this).removeClass('systemBack');
                $('.systemInput').val('');
                // alert(22)
                $('.bNineContentMain .bNineListColor').remove();
                $('.System').trigger('click');
            }
        }else{
            toastr.error('请输入搜索内容！')
        }
    });
    //添加
    $('.systemBtn').click(function(){
        $('.systemAdd').css('display','block');
        $('#popLayer').css('display','block');
    });
    $('.systemAdd-back').click(function(){
        $('.systemAdd').css('display','none');
        $('#popLayer').css('display','none');
    });
    $('#systemAdd').click(function(){
        var bb={
            'systemConfigName':$('.sysNameInput').val(),
            'systemConfigCode':$('.sysCodeInput').val(),
            'systemConfigValue':$('.sysValueInput').val(),
            'remake':$('.sysMarkInput').val()
        };
        $('.systemAdd').css('display','none');
        $('#popLayer').css('display','none');
        var dd=JSON.stringify(bb);
        $.ajax({
            type:'POST',
            url:myUrl+'systemConfig/sysConfigInsert',
            data:{loginId:eId,token:eIdToken,strJson:dd},
            success:function(add){
                // console.log(add);
                if(add.code == 0){
                    $('.System').trigger('click');
                }
            }
        })
    });
    //删除
    $(document).on('click','bNineContentMain .bNineListColor .bNineListDel',function(){
        var sysId=[];
        sysId.push($(this).parent('ul').attr('sysid'));
        var dd=JSON.stringify(sysId);
        // alert(dd);
        var list=$(this).parents('.bNineListColor');
        $.ajax({
            type:'POST',
            url:myUrl+'systemConfig/delectSysConfig',
            data:{loginId:eId,token:eIdToken,deletelist:dd},
            success:function(del){
                console.log(del);
                if(del.code == 0){
                    toastr.success('删除成功！');
                    list.remove();
                }
            }
        })
    });
    //修改
    $(document).on('click','.bNineContentMain .bNineListColor .bNineListEdit',function(){
        //弹窗打开事件
        $('.systemEdi').css('display','block');
        $('#popLayer').css('display','block');
        //弹窗关闭
        $('.systemEdi-back').click(function(){
            $('.systemEdi').css('display','none');
            $('#popLayer').css('display','none');
        });
        //取当前事件的父级与兄弟级
        var systemConfigId=$(this).parent('ul').attr('sysid'); //取ID
        var systemEdiNameInput=$(this).siblings('.bNineListOne');
        var systemConfigCode=$(this).siblings('.bNineListTwo');
        var systemConfigValue=$(this).siblings('.bNineListThree');
        var remake=$(this).siblings('.bNineListFour');
        //弹窗页面取值
        $('.systemEdiNameInput').val(systemEdiNameInput.html());
        $('.systemEdiCodeInput').val(systemConfigCode.html());
        $('.systemEdiValueInput').val(systemConfigValue.html());
        $('.systemEdiMarkInput').val(remake.html());
        //提交
        $('#systemEdi').click(function(){
            var bb={
                'systemConfigName':$('.systemEdiNameInput').val(),
                'systemConfigCode':$('.systemEdiCodeInput').val(),
                'systemConfigValue':$('.systemEdiValueInput').val(),
                'remake':$('.systemEdiMarkInput').val()
            };
            $('.systemEdi').css('display','none');
            $('#popLayer').css('display','none');
            // alert(bb);
            var dd=JSON.stringify(bb);
            // alert(dd);
            $.ajax({
                type:'POST',
                url:myUrl+'systemConfig/updateSysConfig',
                data:{loginId:eId,token:eIdToken,strJson:dd,systemConfigId:systemConfigId},
                cache:false,
                success:function(eidit){
                    // console.log(eidit);
                    if(eidit.code == 0){
                        // $('.System').trigger('click');
                        toastr.success('修改成功');
                        //页面传值
                        systemEdiNameInput.html($('.systemEdiNameInput').val());
                        systemConfigCode.html($('.systemEdiCodeInput').val());
                        systemConfigValue.html($('.systemEdiValueInput').val());
                        remake.html($('.systemEdiMarkInput').val());
                    }
                }
            })
        })
    })
});
//用户管理
$().ready(function(){
    //关联单位
    $('.b5-btn').on("click",function () {
        // 打开弹窗
        $(".b6").css("display","block");
        $('#popLayer').css('display','block');
        //关闭弹窗
        $('.del').click(function(){
            $(".b6").css("display","none");
            $('#popLayer').css('display','none');
        });
        $.ajax({
            type:"POST",
            url:myUrl+"company/selectName",
            data:{pageNum:1,loginId:eId,token:eIdToken},
            success:function(b6Select){
                console.log(b6Select);
                if(b6Select.code == 0){
                    var selectedList="";
                    b6Select.result.forEach(function (item,index) {
                        // console.log(item);
                        // console.log(item.name);
                        selectedList=
                            '<option opId='+item.id+'>'+item.name+'</option>';
                        $('.b6Select').append(selectedList);
                        localStorage.itemNmame = item.id;
                    })
                }else{

                }
            },
            error:function(){
            }
        })
    });
    //创建用户
    $('.bSixSubmit').click(function(){
        //提交之后关闭弹窗
        $(".b6").css("display","none");
        $('#popLayer').css('display','none');
        $.ajax({
            type:"POST",
            url:myUrl+"user/createUserInfo",
            data:{userName:$('.bSixName').val(),companyId:localStorage.itemNmame,loginId:eId,token:eIdToken},
            success:function(bSixSubmit){
                console.log(bSixSubmit);
                $('.bSixName').val("");
                //模拟刷新
                $('.Manger').trigger("click");
            },
            error:function(){

            }
        })
    });
    //邀请注册
    $('.bSixOneSubmit').click(function(){
        //提交之后关闭弹窗
        $(".b6").css("display","none");
        $('#popLayer').css('display','none');
        $.ajax({
            type:"POST",
            url:myUrl+"user/inviteRegistration",
            data:{inviteName:$('.bSixOneName').val(),inviteWay:$('.bSixOneMail').val(),loginId:eId,token:eIdToken},
            success:function(bSix){
                // console.log(bSix);
                if(bSix.code==0){
                    alert("邀请成功");
                    //模拟刷新
                    $('.Manger').trigger("click");
                }else{
                    alert("请求失败");
                }
            },
            error:function(){

            }
        })
    });
    //全选删除
    $('#allSelect').change(function () {
        if($(this).prop("checked")){
            $('.selected-delete input').prop('checked','checked')
        }else{
            $('.selected-delete input').removeAttr('checked')
        }
    });
    //选中删除
    $('.b5-left').click(function(){
        var userArr=[];
        $('.selected-delete input').each(function (index,item) {
            if($(this).get(0).checked){
                userArr.push($(this).parents('li').attr('id'));
                $(this).parents('li').remove();
            }
        });
        // console.log(userArr)
        var dd=JSON.stringify(userArr);
        $.ajax({
            type:'POST',
            url:myUrl+'user/updateUserDeleteInfo',
            data:{loginId:eId,userIdJson:dd,token:eIdToken},
            dataType:'json',
            success:function(userArrDelete){
                // console.log(userArrDelete);
                if(userArrDelete.code==0){
                    alert('删除成功')
                }
                //模拟点击
                $('.Manger').trigger('click');
            }
        })
    });
    //获取总条数-分页
    $('.Manger').click(function(){
        $.ajax({
            type:'POST',
            url:myUrl+'user/selectCount',
            data:{loginId:eId,token:eIdToken},
            success:function(selectCount){
                console.log(selectCount);
                var pagecoung =Math.ceil(selectCount.result/15);
                $('.b5-tbody').attr('selectId',pagecoung);
                $(".zxf_pagediv2").createPage({
                    pageNum: pagecoung,
                    current: 1,
                    backfun: function(e) {
                        //console.log(e);//回调
                    }
                });
            }
        })
    });
    // 分页展示
    $('.zxf_pagediv2').on('click','a',function(){
        var pageNumber= $(this).html();
        $.ajax({
            type:"POST",
            url:myUrl+"user/select",
            data:{pageNum:pageNumber,loginId:eId,token:eIdToken},
            success:function (pageNumList) {
                console.log(pageNumList);
                var pageNumberList="";
                if($('.b5-tbody').has('li').length>0){
                    $('ul.b5-tbody li').remove();
                    pageNumList.result.forEach(function (item,index) {
                        // console.log(item);
                        pageNumberList=
                            '<li id='+item.uId+'>' +
                            '<span class="selected-delete"><input type="checkbox" name="userName"></span>'+
                            '<span id="beforeId">'+item.loginName.loginName+'</span>'+
                            '<span id="beforeName">'+item.uName+'</span>'+
                            '<span id="beforePhone">'+item.uPhone+'</span>'+
                            '<span id="beforeAddress">'+item.companyName.name+'</span>'+
                            '<span id="beforeTime">'+item.uCreateTime+'</span>'+
                            '<span class="b5-tbodyEidit"><span class="exit">编辑</span><span class="b5delete">删除</span></span>'+
                            '</li>';
                        $('ul.b5-tbody').append(pageNumberList);
                    });
                    // alert(11)
                }else{
                    pageNumList.result.forEach(function (item,index) {
                        console.log(item);
                        pageNumberList=
                            '<li id='+item.uId+'>' +
                            '<span class="selected-delete"><input type="checkbox" name="userName"></span>'+
                            '<span id="beforeId">'+item.loginName.loginName+'</span>'+
                            '<span id="beforeName">'+item.uName+'</span>'+
                            '<span id="beforePhone">'+item.uPhone+'</span>'+
                            '<span id="beforeAddress">'+item.companyName.name+'</span>'+
                            '<span id="beforeTime">'+item.uCreateTime+'</span>'+
                            '<span class="b5-tbodyEidit"><span class="exit">编辑</span><span class="b5delete">删除</span></span>'+
                            '</li>';
                        $('ul.b5-tbody').append(pageNumberList);
                    });
                }
            },
            error:function () {
            }
        })
    });
    //分页确定按钮
    $('.zxf_pagediv2').on('click','.zxfokbtn',function(){
        // alert(11)
        // $('.zxfokbtn').attr('id','UnitLoad')
        var pageNum= $('.zxfinput').val();
        $.ajax({
            type:"POST",
            url:myUrl+"user/select",
            data:{pageNum:pageNum,loginId:eId,token:eIdToken},
            success:function (pageNumList) {
                console.log(pageNumList);
                var pageNumberList="";
                if($('.b5-tbody').has('li').length>0){
                    $('ul.b5-tbody li').remove();
                    pageNumList.result.forEach(function (item,index) {
                        // console.log(item);
                        pageNumberList=
                            '<li id='+item.uId+'>' +
                            '<span class="selected-delete"><input type="checkbox" name="userName"></span>'+
                            '<span id="beforeId">'+item.loginName.loginName+'</span>'+
                            '<span id="beforeName">'+item.uName+'</span>'+
                            '<span id="beforePhone">'+item.uPhone+'</span>'+
                            '<span id="beforeAddress">'+item.companyName.name+'</span>'+
                            '<span id="beforeTime">'+item.uCreateTime+'</span>'+
                            '<span class="b7-tbodyEidit"><span class="exitb7">编辑</span><span class="deleteb7">删除</span></span>'+
                            '</li>';
                        $('ul.b5-tbody').append(pageNumberList);
                    });
                    // alert(11)
                }else{
                    pageNumList.result.forEach(function (item,index) {
                        console.log(item);
                        pageNumberList=
                            '<li id='+item.uId+'>' +
                            '<span class="selected-delete"><input type="checkbox" name="userName"></span>'+
                            '<span id="beforeId">'+item.loginName.loginName+'</span>'+
                            '<span id="beforeName">'+item.uName+'</span>'+
                            '<span id="beforePhone">'+item.uPhone+'</span>'+
                            '<span id="beforeAddress">'+item.companyName.name+'</span>'+
                            '<span id="beforeTime">'+item.uCreateTime+'</span>'+
                            '<span class="b5-tbodyEidit"><span class="exit">编辑</span><span class="b5delete">删除</span></span>'+
                            '</li>';
                        $('ul.b5-tbody').append(pageNumberList);
                    });
                }
            },
            error:function () {
            }
        })
    });
    //搜索用户
    $('.b5-right').on('click','span',function(){
        var pageSearch=$('.zxf_pagediv2').children('.current').html();
        if($('#mangerSearch').val() !== ''){
            if($(this).hasClass('unitSearch')){
                $(this).removeClass('unitSearch');
                $(this).addClass('unitBack');
                $.ajax({
                    type:'POST',
                    url:myUrl+'user/likeSelectUser',
                    data:{loginId:eId,token:eIdToken,pageNum:pageSearch,condition:$('#mangerSearch').val()},
                    success:function(mangerSeach){
                        console.log(mangerSeach);
                        if(mangerSeach.code == 0){
                            var pageNumberList="";
                            $('.b5-tbody li').remove();
                            mangerSeach.result.forEach(function(item,index){
                                console.log(item);
                                pageNumberList=
                                    '<li id='+item.uId+'>' +
                                    '<span class="selected-delete"><input type="checkbox" name="userName"></span>'+
                                    '<span id="beforeId">'+item.loginName.loginName+'</span>'+
                                    '<span id="beforeName">'+item.uName+'</span>'+
                                    '<span id="beforePhone">'+item.uPhone+'</span>'+
                                    '<span id="beforeAddress">'+item.companyName.name+'</span>'+
                                    '<span id="beforeTime">'+item.uCreateTime+'</span>'+
                                    '<span class="b5-tbodyEidit"><span class="exit">编辑</span><span class="b5delete">删除</span></span>'+
                                    '</li>';
                                $('ul.b5-tbody').append(pageNumberList);
                            });
                        }
                    }
                });
                // alert(11)
            }else{
                $(this).addClass('unitSearch');
                $(this).removeClass('unitBack');
                // alert(22)
                $('#mangerSearch').val('');
                $('.b5-tbody li').remove();
                $('.Manger').trigger('click');
            }
        }else{
            toastr.error('请输入搜索内容!')
        }
    });
});
//*递归实现获取无级树数据并生成DOM结构*/
var strf = "";
var forTree = function (o,isTop1) {
    // strf="";
    var isTop=isTop1;
    var urlstr = "";
    //  var aetimestr="";
    for(var j=0;j< o.length;j++){
        urlstr=getbTree(j+1,o[j],isTop);
        strf+=urlstr;
        if(!$.isEmptyObject(o[j].childs)){
            forTree(o[j].childs,false);
        }
        // console.log(str);
    }
    return strf;
};
//
function getbTree(i,obj,isTop1) {
    var str = "";
    var commonstr =
        '<li class="bThreeOneList2">' +
        '<span class="downg"><img src="images/downr.png"></span>'+
        '<span class="upr"><img src="images/upr.png"></span> ' +
        '<li class="bThreeOneList12">' +
        '<span class="bThreeOneImg"></span>' +
        '<span class="bThreeOneList11">' + obj.pname + '</span>' +
        '</li>' +
        '<li class="bThreeOneList4">' + obj.pstime + '</li>' +
        '<li class="bThreeOneList13">' + obj.petime + '</li>' +
        '<li class="bThreeOneList14">' + obj.astime + '</li>' +
        '<li class="bThreeOneList15">' + obj.aetime + '</li>' +
        '<li class="bThreeOneList5">'  + '</li>' +
        "<li class='bThreeOneList6'>添加</li>" +
        '<li class="bThreeOneList9">编辑</li>' +
        '<li class="bThreeOneList10">删除</li>';
    if (isTop1) {
        if (!$.isEmptyObject(obj.childs)) {
            str = '<ul class="bThreeOneFather"  pid='+obj.id+'>'+
                '<li class="bThreeOneList1">' + i + '</li>' +
                '</li>' +commonstr + '<div style="clear: both"></div></ul>';
        } else {
            str = '<ul class="bThreeOneFather" pid='+obj.id+'>' +
                '<li class="bThreeOneList1">' + i + '</li>' +
                '</li>' + commonstr + '<li class="bThreeOneList7">构建</li><div style="clear: both"></div></ul>'
        }
    } else {
        if (!$.isEmptyObject(obj.childs)) {
            str = '<ul class="bThreeOneFather"  pid='+obj.id+'>' +
                '<li class="bThreeOneList1">' + i + '</li>' +
                '</li>' +
                commonstr + '<div style="clear: both"></div></ul>';
        } else {
            str = '<ul class="bThreeOneChildren"  pid='+obj.id+'>' +
                '<li class="bThreeOneList1">' + i + '</li>' +
                '</li>' + commonstr + '<li class="bThreeOneList7">构建</li><div style="clear: both"></div></ul>'
        }
    }
    return str;
}
//UE4模型数据展示--进度展示
function mm(s){
    $.ajax({
        type:'POST',
        url:myUrl+'/model/queryModelInfo',
        data:{loginId:eId,token:eIdToken,pId:pId,modelId:s},
        success:function(uE4m){
            if($('.cSixTwoOneTaskSecond1 div').length>0){
                $('.cSixTwoOneTaskSecond1 div').remove()
            };
            if($('.cSixTwoOneTaskOne1 div').length>0){
                $('.cSixTwoOneTaskOne1 div').remove()
            }
            console.log(uE4m);
            var tableUe4mm="";
            var tableUe4mms="";
            uE4m.result.commoninfo.forEach(function(item,index) {
                console.log(item);
                console.log(item.mCode);
                tableUe4mm=
                    '<div class="taskNameDeta">几何属性</div>'+
                    '<div class="cSixTwoOneTaskLeft1" style="clear: both;">'+item.modelPropertyName+'</div>' +
                    '<div class="cSixTwoOneTaskRight1">'+item.modelPropertyValue+'</div>'+
                    '<div style="clear: both"></div>';
                $('.cSixTwoOneTaskSecond1').append(tableUe4mm);
            });
            uE4m.result.otherinfo.forEach(function(item,index) {
                var state=""
                if(item.mStatu==1){
                    state="施工中"
                }else if(item.mStatu==2){
                    state="准时完工"
                }else if(item.mStatu==3){
                    state="临时完工"
                }else{
                    state="未开工"
                }
                console.log(item);
                tableUe4mms=
                    '<div class="taskNameDeta">非几何属性</div>'+
                    '<div class="cSixTwoOneTaskLeft1" style="clear: both;">构建名称2</div>' +
                    '<div class="cSixTwoOneTaskRight1">'+item.mCode+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft1" style="clear: both;">计划开始时间</div>' +
                    '<div class="cSixTwoOneTaskRight1">'+item.mpetime+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft1" style="clear: both;">计划结束时间</div>' +
                    '<div class="cSixTwoOneTaskRight1">'+item.mpstime+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft1" style="clear: both;">实际开始时间</div>' +
                    '<div class="cSixTwoOneTaskRight1">'+item.maetime+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft1" style="clear: both;">实际结束时间</div>' +
                    '<div class="cSixTwoOneTaskRight1">'+item.mastime+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft1" style="clear: both;">施工状态</div>' +
                    '<div class="cSixTwoOneTaskRight1">'+state+'</div>'+
                    '<div style="clear: both"></div>';
                $('.cSixTwoOneTaskOne1').append(tableUe4mms);
            });
            if($('.cSixTwoOneTaskSecond1 div').length>0){
                $('.cSixTwoOneTaskOne div:eq(17)').remove()
            }
        }
    })
}
//UE4模型数据展示--物料使用
function modelUe4(c){
    // alert(c);
    //调用src/modelJS/index.js里的meshcode
    $.ajax({
        type:'POST',
        url:myUrl+'/material/lookuseMaterialInfo',
        data:{loginId:eId,token:eIdToken,pId:pId,modelId:c},
        success:function (Ue4) {
            console.log(Ue4);
            console.log(Ue4.mBrand);
            var tableUe4="";
            Ue4.result.forEach(function( item,index){
                console.log(item);
                console.log(item.mumaterial.mBrand);
                console.log(item.muunit.uName);
                // tableUe4=$(".cSixTwoOneContentMessS ul").clone();
                // tableUe4.removeAttr('hidden');
                // tableUe4.attr('muid',item.muid);
                // tableUe4.children('li').eq(0).html(item.mumaterial.mBrand);
                tableUe4=
                    '<ul muId='+item.muid+' mid='+item.mumaterial.mId+'>'+
                    '<li>'+item.mumaterial.mclass+'</li>'+
                    '<li>'+item.mumaterial.mType+'</li>'+
                    '<li>'+item.mumaterial.mBrand+'</li>'+
                    '<li>'+item.mumaterial.mSeries+'</li>'+
                    '<li uid='+item.muunit.uid+'>'+item.muuse+item.muunit.uName+'</li>'+
                    '<li style="color: blue;cursor: pointer">删除</li>'+
                    '</ul>'+
                    '<div style="clear: both"></div>';
                $(".cSixTwoOneContentMess").append(tableUe4);


            });
            if($('.cSixTwoOneContentMess ul').length>0){
                $('.cSixTwoOneContentMess ul:gt(2)').remove();
            }
        },
        error:function () {

        }
    });
    $.ajax({
        type:'POST',
        url:myUrl+'/model/queryModelInfo',
        data:{loginId:eId,token:eIdToken,pId:pId,modelId:c},
        success:function(uE4m){
            if($('.cSixTwoOneTaskSecond div').length>0){
                $('.cSixTwoOneTaskSecond div').remove()
            }
            if($('.cSixTwoOneTaskOne div').length>0){
                $('.cSixTwoOneTaskOne div').remove()
            }
            console.log(uE4m);
            var tableUe4mm="";
            var tableUe4mms="";
            uE4m.result.commoninfo.forEach(function(item,index) {
                console.log(item);
                console.log(item.mCode);
                tableUe4mm=
                    '<div class="taskNameDeta">几何属性</div>'+
                    '<div class="cSixTwoOneTaskLeft" style="clear: both;">'+item.modelPropertyName+'</div>' +
                    '<div class="cSixTwoOneTaskRight">'+item.modelPropertyValue+'</div>'+
                    '<div style="clear: both"></div>';
                $('.cSixTwoOneTaskSecond').append(tableUe4mm);
            });
            uE4m.result.otherinfo.forEach(function(item,index) {
                var state="";
                if(item.mStatu==1){
                    state="施工中"
                }else if(item.mStatu==2){
                    state="准时完工"
                }else if(item.mStatu==3){
                    state="临时完工"
                }else{
                    state="未开工"
                }
                console.log(item);
                tableUe4mms=
                    '<div class="taskNameDeta">非几何属性</div>'+
                    '<div class="cSixTwoOneTaskLeft" style="clear: both;">构建名称2</div>' +
                    '<div class="cSixTwoOneTaskRight">'+item.mCode+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft" style="clear: both;">计划开始时间</div>' +
                    '<div class="cSixTwoOneTaskRight">'+item.mpetime+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft" style="clear: both;">计划结束时间</div>' +
                    '<div class="cSixTwoOneTaskRight">'+item.mpstime+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft" style="clear: both;">实际开始时间</div>' +
                    '<div class="cSixTwoOneTaskRight">'+item.maetime+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft" style="clear: both;">实际结束时间</div>' +
                    '<div class="cSixTwoOneTaskRight">'+item.mastime+'</div>'+
                    '<div style="clear: both"></div>'+
                    '<div class="cSixTwoOneTaskLeft" style="clear: both;">施工状态</div>' +
                    '<div class="cSixTwoOneTaskRight">'+state+'</div>'+
                    '<div style="clear: both"></div>';
                $('.cSixTwoOneTaskOne').append(tableUe4mms);
            });

        }
    })
}



